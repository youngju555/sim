// esp32ë¡œ ì›¹ì„œë²„ë¥¼ ë§Œë“¤ì–´ì„œ ì™€ì´íŒŒì´ ì—°ê²°í•´ ë²„íŠ¼ìœ¼ë¡œ ì¡°ì‘.

#include <WiFi.h>
#include <WebServer.h>

// ğŸ“¡ WiFi ì •ë³´
const char* ssid = "ConnectValue_A402_2G";
const char* password = "CVA402!@#$";

// ğŸ’» ì›¹ì„œë²„ í¬íŠ¸ 80
WebServer server(80);

// ğŸ“¡ ì•„ë‘ì´ë…¸ì™€ ì—°ê²°ëœ ì‹œë¦¬ì–¼ í¬íŠ¸ ì„¤ì •
#define ARDUINO_TX 17
#define ARDUINO_RX 16
HardwareSerial ArduinoSerial(2); // UART2 ì‚¬ìš© (Serial2)

// ğŸŸ¢ HTML ë²„íŠ¼ í˜ì´ì§€ ìƒì„±
String getHTML() {
  String html = "<html><head><meta charset='utf-8'>";
  html += "<style>";
  html += "body { font-family: Arial; text-align: center; margin-top: 50px; }";
  html += "button { font-size: 24px; padding: 20px 40px; margin: 10px; }";
  html += "</style></head><body>";
  html += "<h2>ESP32 RCì¹´ ì œì–´</h2>";
  html += "<a href='/F'><button>ì „ì§„</button></a><br>";
  html += "<a href='/B'><button>í›„ì§„</button></a><br>";
  html += "<a href='/L'><button>ì¢ŒíšŒì „</button></a><br>";
  html += "<a href='/R'><button>ìš°íšŒì „</button></a><br>";
  html += "<a href='/S'><button>ì •ì§€</button></a><br>";
  html += "</body></html>";
  return html;
}


void setup() {
  Serial.begin(115200); // ë””ë²„ê·¸ìš© ì‹œë¦¬ì–¼
  ArduinoSerial.begin(9600, SERIAL_8N1, ARDUINO_RX, ARDUINO_TX); // ì•„ë‘ì´ë…¸ì™€ í†µì‹ 

  // WiFi ì—°ê²°
  WiFi.begin(ssid, password);
  Serial.print("WiFi ì—°ê²° ì¤‘");
  while (WiFi.status() != WL_CONNECTED) {
    delay(500);
    Serial.print(".");
  }
  Serial.println("\nWiFi ì—°ê²° ì™„ë£Œ!");
  Serial.print("ì›¹ì„œë²„ ì£¼ì†Œ: http://");
  Serial.println(WiFi.localIP());

  // ì›¹ì„œë²„ ê²½ë¡œ ì„¤ì •
  server.on("/", []() {
    server.send(200, "text/html", getHTML());
  });

  server.on("/F", []() {
    ArduinoSerial.write('F');
    server.send(200, "text/html", "<p>ì „ì§„</p><a href='/'>ë’¤ë¡œ</a>");
  });

  server.on("/B", []() {
    ArduinoSerial.write('B');
    server.send(200, "text/html", "<p>í›„ì§„</p><a href='/'>ë’¤ë¡œ</a>");
  });

  server.on("/L", []() {
    ArduinoSerial.write('L');
    server.send(200, "text/html", "<p>ì¢ŒíšŒì „</p><a href='/'>ë’¤ë¡œ</a>");
  });

  server.on("/R", []() {
    ArduinoSerial.write('R');
    server.send(200, "text/html", "<p>ìš°íšŒì „</p><a href='/'>ë’¤ë¡œ</a>");
  });

  server.on("/S", []() {
    ArduinoSerial.write('S');
    server.send(200, "text/html", "<p>ì •ì§€</p><a href='/'>ë’¤ë¡œ</a>");
  });

  server.begin();
  Serial.println("ì›¹ì„œë²„ ì‹œì‘ë¨!");
}

void loop() {
  server.handleClient(); // ì›¹ ìš”ì²­ ì²˜ë¦¬
}
